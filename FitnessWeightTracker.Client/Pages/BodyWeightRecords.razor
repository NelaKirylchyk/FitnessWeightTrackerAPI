@page "/bodyweight"
@using Microsoft.AspNetCore.Components.Authorization

<h3>Body Weight Records</h3>

@if (IsLoading)
{
    <p>Loading...</p>
}
else
{
    <AuthorizeView>
        <Authorized Context="auth">
            @if (!string.IsNullOrEmpty(Message))
            {
                <div>@Message</div>
            }

            <EditForm Model="@EditModel" OnValidSubmit="SaveAsync">
                <DataAnnotationsValidator />
                <ValidationSummary />
                <div class="mb-2">
                    <label>Date: </label>
                    <InputDate @bind-Value="EditModel.Date" />
                </div>
                <div class="mb-2">
                    <label>Weight: </label>
                    <InputNumber @bind-Value="EditModel.Weight" />
                </div>
                <button type="submit">@(IsEditing ? "Update" : "Add")</button>
                @if (IsEditing)
                {
                    <button type="button" @onclick="CancelEdit">Cancel</button>
                }
            </EditForm>

            <hr />

            <table class="table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Weight</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var r in Records)
                    {
                        <tr>
                            <td>@r.Date.ToString("yyyy-MM-dd")</td>
                            <td>@r.Weight</td>
                            <td>
                                <button @onclick="() => BeginEdit(r)">Edit</button>
                                <button @onclick="() => DeleteAsync(r.Id)">Delete</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </Authorized>
        <NotAuthorized>
            <div class="alert alert-info">
                Please log in to view your body weight records.
            </div>
        </NotAuthorized>
    </AuthorizeView>
}